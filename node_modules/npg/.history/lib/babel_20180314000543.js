const fse = require("fs-extra");
const chalk = require("chalk");
const babel = require("@babel/core");

const paths = require("./paths");

module.exports = (options = {}) => {
  const { version = process.version } = options;
  console.log("------------");
  console.log(version);
  console.log("------------");
  // Ensure that the "dist" directory is created.
  fse.ensureDirSync(paths.pkg.dist);
  // Empty the "dist" directory.
  fse.emptyDirSync(paths.pkg.dist);
  const { code } = babel.transformFileSync("src/index.js", {
    babelrc: false,
    plugins: [
      paths.npg.plugins.proposalClassProperties,
      paths.npg.plugins.proposalObjectRestSpread,
      paths.npg.plugins.transformRuntime
    ],
    presets: [[paths.npg.presets.env, { targets: { node: "6.10" } }]]
  });
  fse.outputFileSync("dist/index.js", code, { encoding: "utf8" });
};
