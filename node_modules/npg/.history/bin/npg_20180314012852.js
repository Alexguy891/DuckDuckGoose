#!/usr/bin/env node
const path = require("path");
const program = require("commander");

const create = require("../lib/create");
const build = require("../lib/build");
const start = require("../lib/start");

program
  .command("create [name]")
  .alias("c")
  .option("-v, --version [value]", "Target Node version")
  .description("Create a new package")
  .action(pkgName => {
    let pkgPath;
    if (pkgName) {
      pkgPath = path.resolve(process.cwd(), pkgName);
    } else {
      pkgPath = process.cwd();
      pkgName = path.basename(pkgPath);
    }
    const nodeVersion = cmd.version || process.version.replace("v", "");
    create({ pkgName, pkgPath, nodeVersion });
  });

const b = program
  .command("build")
  .alias("b")
  .description("Build a package")
  .option("-v, --version [value]", "Target Node version")
  .action(cmd => {
    const version = cmd.version || process.version.replace("v", "");
    build({ version });
  });

program
  .command("start")
  .alias("s")
  .description("Start a package and rebuild on every change")
  .action(cmd => {
    start();
  });

program.parse(process.argv);
