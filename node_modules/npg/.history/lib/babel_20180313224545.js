const { spawn } = require("child_process");
const chalk = require("chalk");
const path = require("path");
const paths = require("./paths");

const babel = function(args) {
  // Compose link to the "babel" shell script.
  const command = `${paths.bin}/babel`;
  // Extend default arguments with provided ones.
  const plugins = [
    paths.plugins.proposalClassProperties,
    paths.plugins.proposalObjectRestSpread,
    paths.plugins.transformRuntime
  ];
  const presets = [paths.presets.env];
  args = [
    paths.src,
    `--out-dir=${paths.dist}`,
    `--presets=${presets.join(",")}`,
    `--plugins=${plugins.join(",")}`,
    `--ignore=${paths.dist},${paths.tests}`,
    "--copy-files"
  ];
  // Run the "babel" command with arguments.
  const child = spawn(command, args);
  child.stdout.on("data", chunk => {
    console.log(chunk.toString("utf8").trim());
  });
  child.stderr.on("data", chunk => {
    console.log(chalk.red(chunk.toString("utf8").trim()));
  });
};

module.exports = babel;
