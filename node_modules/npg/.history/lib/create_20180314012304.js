const fse = require("fs-extra");
const chalk = require("chalk");
const path = require("path");

const paths = require("./paths");
const packageTemplate = require("../templates/package");
const indexTemplate = require("../templates/index");

module.exports = ({ name: name, path, version }) => {
  const directoryName = name;
  if (name === ".") {
    name = path.basename(paths.pkg.root);
  }

  if (!name) {
  }
  // If name was passed then create directory otherwise initialize package in
  // the current directory.
  if (directoryName !== ".") {
    // Stop if a directory already exists.
    if (fs.existsSync(directoryName)) {
      console.log(chalk.red(`The "${directoryName}" directory already exists`));
      process.exit(1);
    }
    // Create a new directory.
    console.log(chalk.cyan("Creating package directory..."));
    fs.mkdirSync(directoryName);
  }
  // Create package.json file.
  const packageJsonPath = `${directoryName}/package.json`;
  if (!fs.existsSync(packageJsonPath)) {
    console.log(chalk.cyan("Creating package.json file..."));
    fs.writeFileSync(packageJsonPath, packageTemplate({ name }));
  }
  const srcPath = `${directoryName}/src`;
  if (!fs.existsSync(srcPath)) {
    console.log(chalk.cyan('Creating "src" directory...'));
    fs.mkdirSync(srcPath);
  }
  const indexJsPath = `${directoryName}/src/index.js`;
  if (!fs.existsSync(indexJsPath)) {
    console.log(chalk.cyan('Creating "src/index.js" file...'));
    fs.writeFileSync(indexJsPath, indexTemplate());
  }
};
