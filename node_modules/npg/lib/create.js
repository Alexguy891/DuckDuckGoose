const fs = require("fs");
const fse = require("fs-extra");
const chalk = require("chalk");
const path = require("path");

const paths = require("./paths");
const packageTemplate = require("../templates/package");
const indexTemplate = require("../templates/index");

module.exports = options => {
  const { pkgName, pkgPath, nodeVersion } = options;
  console.log(
    chalk.cyan(
      `Initializing the "${pkgName}" package for Node v${nodeVersion}...`
    )
  );
  // Ensure that package directory exists.
  fse.ensureDirSync(pkgPath);
  // Create package.json file.
  const packageJsonPath = path.resolve(pkgPath, "package.json");
  if (!fs.existsSync(packageJsonPath)) {
    console.log(chalk.cyan('Creating "package.json" file...'));
    fse.outputFileSync(packageJsonPath, packageTemplate(options));
  }
  // Create index.js file.
  const indexJsPath = path.resolve(pkgPath, "src", "index.js");
  if (!fs.existsSync(indexJsPath)) {
    console.log(chalk.cyan('Creating "src/index.js" file...'));
    fse.outputFileSync(indexJsPath, indexTemplate(options));
  }
};
