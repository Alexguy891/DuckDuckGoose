const fs = require("fs");
const path = require("path");
const paths = require("./paths");
// const babel = require("./babel");
const babel = require("@babel/core");

module.exports = function() {
  fs.mkdirSync(path.resolve(paths.pkg, "dist"));
  const { code } = babel.transformFileSync("src/index.js", {
    babelrc: false,
    // extends: path.resolve(__dirname, "..", "config", ".babelrc")
    plugins: [
      path.resolve(
        paths.base,
        "node_modules",
        "@babel/plugin-proposal-class-properties"
      ),
      path.resolve(
        paths.base,
        "node_modules",
        "@babel/plugin-proposal-object-rest-spread"
      ),
      path.resolve(
        paths.base,
        "node_modules",
        "@babel/plugin-transform-runtime"
      )
    ],
    presets: [
      [
        "@babel/preset-env",
        {
          targets: {
            node: "6.10"
          }
        }
      ]
    ]
  });
  fs.writeFileSync("dist/index.js", code, { encoding: "utf8" });
  console.log(code);
};
